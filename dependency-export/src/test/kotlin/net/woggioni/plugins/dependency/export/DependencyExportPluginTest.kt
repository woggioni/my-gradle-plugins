/*
 * This Kotlin source file was generated by the Gradle 'init' task.
 */
package net.woggioni.plugins.dependency.export

import org.gradle.testkit.runner.GradleRunner
import org.junit.jupiter.api.BeforeEach
import org.junit.jupiter.api.Test
import org.junit.jupiter.api.io.TempDir
import java.nio.file.Path


class DependencyExportPluginTest {

    @TempDir
    lateinit var testGradleHomeDir : Path

    @TempDir
    lateinit var testProjectDir : Path
    lateinit var buildFile : Path

    @BeforeEach
    fun setup() {
        buildFile = testProjectDir.resolve("build.gradle.kts")
    }

    fun getStandardGradleRunnerFor(taskName: String): GradleRunner {
        return GradleRunner.create()
                .withDebug(true)
                .withProjectDir(testProjectDir.toFile())
                .withArguments(taskName, "-s", "--info", "-g", testGradleHomeDir.toString())
                .withPluginClasspath()
    }

    @Test
    fun testKotlin() {
        installResource("build.gradle.kts", testProjectDir)
        installResource("settings.gradle.kts", testProjectDir)
        installResource("gradle.properties", testProjectDir)
        val runner = getStandardGradleRunnerFor("exportDependencies")
        runner.build()
    }

    @Test
    fun testGroovy() {
        installResource("build.gradle", testProjectDir)
        installResource("settings.gradle.kts", testProjectDir)
        installResource("gradle.properties", testProjectDir)
        val runner = getStandardGradleRunnerFor("exportDependencies")
        runner.build()
    }
}
